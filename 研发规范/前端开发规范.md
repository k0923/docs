这是一个整合了**核心架构理念**、**目录结构**以及**文件命名规范**的完整版开发手册。

建议将以下内容保存为 `ARCHITECTURE.md` 或 `README.md`，作为团队开发的“最高准则”。

---

# 前端架构与开发规范手册 (React Router v7 + Feature-Based)

本文档旨在统一团队的开发模式，融合了 **Feature-Based（特性驱动）**、**Co-location（就近原则）** 以及 **React Router v7** 的最佳实践。

---

## 1. 核心设计哲学

1.  **分层治理**：
    - **UI 层 (`components`)**：纯视觉表现，**严禁**包含业务逻辑、API 调用或读取全局 Store。
    - **业务层 (`features`)**：核心业务闭环（提供 API、状态、翻译、类型定义），类似“乐高积木”。
    - **路由层 (`pages`)**：控制器 (Controller)，负责数据组装 (Loader) 和流程分发，类似“拼装好的模型”。
2.  **数据双轨制**：
    - **服务端数据 (Server State)**：优先使用 RR7 `loader` 获取，`useLoaderData` 消费。
    - **交互状态 (Client State)**：使用 Zustand 管理（购物车、选中态、UI 开关）。
3.  **类型主权 (Type Sovereignty)**：
    - 类型定义属于其“单一数据源”所在的领域，其他领域仅引用，不可重复定义。

---

## 2. 全景目录结构

```text
src/
├── assets/                  # 静态资源
├── components/              # 【通用展现层】 (纯 UI，无业务属性)
│   ├── ui/                  # 原子组件 (Button, Input, Shadcn-like)
│   ├── layout/              # 布局组件 (Navbar, Sidebar)
│   └── modules/             # 复合组件 (RichEditor - 需 Context 隔离状态)
│
├── features/                # 【业务领域层】 (核心逻辑 - 乐高积木)
│   ├── auth/                # 示例：认证域 (Source of Truth)
│   │   ├── api/             # authApi.ts (login, getUser)
│   │   ├── components/      # 业务组件 (LoginForm, UserAvatar)
│   │   ├── stores/          # authStore.ts (useAuthStore)
│   │   ├── types/           # authTypes.ts (User, Permission)
│   │   └── locales/         # zh.ts
│   ├── order/               # 示例：订单域
│   └── shared/              # 示例：共享业务域 (Address, PaymentMethod)
│
├── pages/                   # 【路由页面层】 (RR7 控制器 - 拼装车间)
│   ├── dashboard/           # 复杂页面
│   │   ├── components/      # [私有组件] 仅此页面使用的 UI
│   │   ├── stores/          # [私有状态] 仅此页面使用的 Zustand (需 Reset)
│   │   └── DashboardPage.tsx # 入口
│
├── locales/                 # 【全局通用翻译】 (common.ts)
├── stores/                  # 【全局应用状态】 (themeStore.ts, toastStore.ts)
├── hooks/                   # 全局通用 Hooks (useDebounce.ts)
├── lib/                     # 基础设施 (axios, i18n, utils)
├── types/                   # 【全局通用类型】 (apiTypes.ts, env.d.ts)
└── router/                  # 路由配置
```

---

## 3. 命名规范 (Naming Convention)

虽然目录已经提供了上下文，但为了**避免 IDE 标签页混乱**、**优化模糊搜索**以及**提升 Code Review 可读性**，我们**强制**在以下文件中保留功能后缀。

### 3.1 文件命名表

| 文件类型  | 所在目录      | ❌ 错误命名      | ✅ 正确命名 (Pattern) | 理由                           |
| :-------- | :------------ | :--------------- | :-------------------- | :----------------------------- |
| **Store** | `stores/`     | `auth.ts`        | **`authStore.ts`**    | 避免混淆，搜 `auth store` 直达 |
| **API**   | `api/`        | `auth.ts`        | **`authApi.ts`**      | 区分 API 定义与类型定义        |
| **Types** | `types/`      | `auth.ts`        | **`authTypes.ts`**    | 区分类型文件                   |
| **Utils** | `lib/`        | `date.ts`        | **`dateUtils.ts`**    | 明确工具属性                   |
| **组件**  | `components/` | `ButtonComp.tsx` | **`Button.tsx`**      | **特例**：组件通常无需后缀     |

### 3.2 为什么这样做？

当你在编辑器打开多个文件时：

- **Bad**: `auth.ts`, `auth.ts`, `auth.ts` (哪个是 Store？哪个是 API？)
- **Good**: `authApi.ts`, `authStore.ts`, `authTypes.ts` (一目了然)

---

## 4. 决策指南：代码该写在哪？

### 4.1 组件 (Components)

- **是路由入口 (URL 对应)？** $\rightarrow$ `src/pages/`
- **含业务逻辑/API？** $\rightarrow$ `src/features/<Feature>/components/`
- **纯 UI 且通用？** $\rightarrow$ `src/components/ui`
- **只在当前页面用？** $\rightarrow$ `src/pages/<Page>/components/`

### 4.2 状态 (Zustand Stores)

- **业务数据实体 (User, Cart)？** $\rightarrow$ `src/features/<Feature>/stores/`
- **全局 UI (Theme, Toast)？** $\rightarrow$ `src/stores/`
- **单页临时复杂交互？** $\rightarrow$ `src/pages/<Page>/stores/` _(需 useEffect return reset)_

### 4.3 API 请求

- **原则**：API 函数定义在 **返回数据所属的领域**，而不是调用的页面。
  - _示例_：`features/order` 里的页面需要查询用户信息，调用的是 `features/auth/api/getUser`。

---

## 5. 架构 Q&A (深度辨析)

### Q1: Features 和 Pages 的区别是什么？

| 维度       | **Features (业务特性层)** | **Pages (路由页面层)**       |
| :--------- | :------------------------ | :--------------------------- |
| **比喻**   | **乐高积木** (红砖、轮胎) | **拼装模型** (跑车、城堡)    |
| **职责**   | 提供能力 (API、UI、逻辑)  | 组装能力，响应路由，获取数据 |
| **复用性** | 高                        | 低 (Page 是一次性的)         |

### Q2: 如果某个 Type 横跨两个 Features，定义在哪？

遵循 **“所有权原则 (Ownership Principle)”**：

1.  **主从关系**：`Order` 依赖 `User`。`User` 定义在 `features/auth/types`，Order 模块直接 import。
2.  **通用值对象**：`Address`、`Money`。定义在 `features/shared/types`。
3.  **技术通用**：`Pagination`、`ApiResponse`。定义在 `src/types/`。

---

## 6. 开发模式示例 (Code Patterns)

### 6.1 页面协调模式 (Page Orchestration)

**Page** 是指挥官，负责从不同的 Feature 拿数据，拼装后传给组件。

```tsx
// src/pages/order/OrderDetailPage.tsx
import { useLoaderData } from 'react-router-dom'
// ✅ 引用不同领域的 API 和 Type
import { getOrder } from '@/features/order/api/orderApi'
import { getUser } from '@/features/auth/api/authApi'
import type { Order } from '@/features/order/types/orderTypes'
import type { User } from '@/features/auth/types/authTypes'

// 1. Loader: 并行请求，组合数据
export async function loader({ params }: any) {
  const order = await getOrder(params.id)
  const user = await getUser(order.userId)
  return { order, user }
}

// 2. Component: 消费数据，传给 Feature 组件
export default function OrderDetailPage() {
  const { order, user } = useLoaderData() as { order: Order; user: User }

  return (
    <div className="layout">
      <OrderSummary order={order} />
      <UserCard user={user} />
    </div>
  )
}
```

### 6.2 引用语义化

```typescript
// ✅ 好的引用：即使不看代码，也知道引入的是 Store
import { useAuthStore } from '@/features/auth/stores/authStore'

// ❌ 差的引用：语义不明
import { useAuth } from '@/features/auth/stores/auth'
```

---

## 7. 代码演进策略 (Refactoring)

代码位置遵循 **“提升策略 (Lift-up Strategy)”**：

1.  **Level 1 (Incubation)**：新功能默认放在 `src/pages/xxx/` (私有)。
2.  **Level 2 (Promotion)**：当 Page B 也需要用到 Page A 的逻辑 $\rightarrow$ 提升到 `src/features/xxx/`。
3.  **Level 3 (Generalization)**：当组件完全与业务解耦 $\rightarrow$ 提升到 `src/components/` 或 `src/hooks/`。
